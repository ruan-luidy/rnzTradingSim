<UserControl
  x:Class="rnzTradingSim.Views.Games.MinesView"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:hc="https://handyorg.github.io/handycontrol"
  xmlns:local="clr-namespace:rnzTradingSim.Views.Games"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  d:DesignHeight="600"
  d:DesignWidth="1070"
  mc:Ignorable="d">

  <Grid Margin="20">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
    </Grid.RowDefinitions>

    <!--  Game Title  -->
    <StackPanel
      Grid.Row="0"
      Margin="0,0,0,20"
      HorizontalAlignment="Left">
      <TextBlock
        Margin="0,0,0,10"
        HorizontalAlignment="Left"
        FontSize="32"
        FontWeight="Bold"
        Foreground="White"
        Text="Mines" />
      <TextBlock
        HorizontalAlignment="Left"
        FontSize="16"
        Foreground="#8b8b8b"
        Text="Navigate through the minefield and cash out before hitting a mine!"
        TextWrapping="Wrap" />
    </StackPanel>

    <!--  Stats Row  -->
    <Grid Grid.Row="1" Margin="0,0,0,30">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="*" />
      </Grid.ColumnDefinitions>

      <!--  Balance Display  -->
      <Border
        Grid.Column="0"
        Margin="0,0,10,0"
        Padding="15"
        Background="#0f0f0f"
        BorderBrush="#2a2a2a"
        BorderThickness="1"
        CornerRadius="8">
        <StackPanel HorizontalAlignment="Center">
          <TextBlock
            Margin="0,0,0,5"
            HorizontalAlignment="Center"
            FontSize="12"
            Foreground="#8b8b8b"
            Text="Balance" />
          <TextBlock
            HorizontalAlignment="Center"
            FontSize="16"
            FontWeight="Bold"
            Foreground="White"
            Text="{Binding PlayerBalance, StringFormat='{}{0:C}'}" />
        </StackPanel>
      </Border>

      <!--  Current Multiplier  -->
      <Border
        Grid.Column="1"
        Margin="5,0"
        Padding="15"
        Background="#0f0f0f"
        BorderBrush="#2a2a2a"
        BorderThickness="1"
        CornerRadius="8">
        <StackPanel HorizontalAlignment="Center">
          <TextBlock
            Margin="0,0,0,5"
            HorizontalAlignment="Center"
            FontSize="12"
            Foreground="#8b8b8b"
            Text="Current Multiplier" />
          <TextBlock
            HorizontalAlignment="Center"
            FontSize="16"
            FontWeight="Bold"
            Foreground="#22c55e"
            Text="{Binding CurrentMultiplier, StringFormat={}{0:F2}x}" />
        </StackPanel>
      </Border>

      <!--  Potential Win Display  -->
      <Border
        Grid.Column="2"
        Margin="10,0,0,0"
        Padding="15"
        Background="#0f0f0f"
        BorderBrush="#2a2a2a"
        BorderThickness="1"
        CornerRadius="8">
        <StackPanel HorizontalAlignment="Center">
          <TextBlock
            Margin="0,0,0,5"
            HorizontalAlignment="Center"
            FontSize="12"
            Foreground="#8b8b8b"
            Text="Potential Win" />
          <TextBlock
            HorizontalAlignment="Center"
            FontSize="16"
            FontWeight="Bold"
            Foreground="#f59e0b"
            Text="{Binding PotentialWin, StringFormat='{}{0:C}'}" />
        </StackPanel>
      </Border>
    </Grid>

    <!--  Main Game Area  -->
    <Grid Grid.Row="2">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="400" />
      </Grid.ColumnDefinitions>

      <!--  Mine Grid Container  -->
      <Border
        Grid.Column="0"
        Margin="0,0,20,0"
        Padding="40"
        Background="#0f0f0f"
        BorderBrush="#2a2a2a"
        BorderThickness="1"
        CornerRadius="12">
        <UniformGrid
          Name="MineGrid"
          HorizontalAlignment="Center"
          VerticalAlignment="Center"
          Columns="5"
          Rows="5">
          <!--  Grid will be populated programmatically  -->
        </UniformGrid>
      </Border>

      <!--  Right Panel - Game Controls  -->
      <StackPanel Grid.Column="1">

        <!--  Number of Mines Control  -->
        <TextBlock
          Margin="0,0,0,15"
          FontSize="18"
          FontWeight="Bold"
          Foreground="White"
          Text="Number of Mines" />

        <Border
          Margin="0,0,0,20"
          Padding="20"
          Background="#0f0f0f"
          BorderBrush="#2a2a2a"
          BorderThickness="1"
          CornerRadius="12">
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="Auto" />
              <ColumnDefinition Width="*" />
              <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <Button
              Grid.Column="0"
              Width="50"
              Height="50"
              hc:BorderElement.CornerRadius="8"
              hc:IconElement.Geometry="{StaticResource SubGeometry}"
              hc:IconElement.Width="20"
              Background="#1f1f1f"
              BorderBrush="#404040"
              BorderThickness="1"
              Command="{Binding DecreaseMinesCommand}"
              FontSize="20"
              FontWeight="Bold" />

            <TextBlock
              Grid.Column="1"
              HorizontalAlignment="Center"
              VerticalAlignment="Center"
              FontSize="28"
              FontWeight="Bold"
              Foreground="White"
              Text="{Binding NumberOfMines}" />

            <Button
              Grid.Column="2"
              Width="50"
              Height="50"
              hc:BorderElement.CornerRadius="8"
              hc:IconElement.Geometry="{StaticResource AddGeometry}"
              hc:IconElement.Width="20"
              Background="#1f1f1f"
              BorderBrush="#404040"
              BorderThickness="1"
              Command="{Binding IncreaseMinesCommand}"
              FontSize="20"
              FontWeight="Bold" />
          </Grid>
        </Border>

        <!--  Probability Info  -->
        <TextBlock
          Margin="0,0,0,15"
          FontSize="14"
          FontWeight="SemiBold"
          Foreground="#22c55e"
          Text="{Binding ProbabilityText}"
          TextWrapping="Wrap" />

        <TextBlock
          Margin="0,0,0,25"
          FontSize="12"
          Foreground="#8b8b8b"
          Text="Note: Maximum payout per game is capped at $2,000,000."
          TextWrapping="Wrap" />

        <!--  Bet Amount  -->
        <TextBlock
          Margin="0,0,0,15"
          FontSize="18"
          FontWeight="Bold"
          Foreground="White"
          Text="Bet Amount" />

        <TextBox
          Name="BetAmountTextBox"
          Margin="0,0,0,15"
          Padding="15,12"
          hc:BorderElement.CornerRadius="8"
          Background="#1f1f1f"
          BorderBrush="#404040"
          BorderThickness="1"
          FontSize="16"
          Foreground="White"
          Text="{Binding BetAmount, UpdateSourceTrigger=PropertyChanged, StringFormat=F2}" />

        <TextBlock
          Margin="0,0,0,20"
          FontSize="12"
          Foreground="#8b8b8b"
          Text="{Binding MaxBetText}" />

        <!--  Quick Bet Buttons  -->
        <Grid Margin="0,0,0,30">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="*" />
          </Grid.ColumnDefinitions>

          <Button
            Grid.Column="0"
            Width="80"
            Margin="0,0,5,0"
            hc:BorderElement.CornerRadius="8"
            Background="#1f1f1f"
            BorderBrush="#404040"
            BorderThickness="1"
            Command="{Binding SetBetPercentageCommand}"
            CommandParameter="25"
            Content="25%" />

          <Button
            Grid.Column="1"
            Width="80"
            Margin="5,0"
            hc:BorderElement.CornerRadius="8"
            Background="#1f1f1f"
            BorderBrush="#404040"
            BorderThickness="1"
            Command="{Binding SetBetPercentageCommand}"
            CommandParameter="50"
            Content="50%" />

          <Button
            Grid.Column="2"
            Width="80"
            Margin="5,0"
            hc:BorderElement.CornerRadius="8"
            Background="#1f1f1f"
            BorderBrush="#404040"
            BorderThickness="1"
            Command="{Binding SetBetPercentageCommand}"
            CommandParameter="75"
            Content="75%"
            Foreground="White" />

          <Button
            Grid.Column="3"
            Width="80"
            Margin="5,0,0,0"
            hc:BorderElement.CornerRadius="8"
            Background="#1f1f1f"
            BorderBrush="#404040"
            BorderThickness="1"
            Command="{Binding SetBetPercentageCommand}"
            CommandParameter="100"
            Content="Max"
            Foreground="White" />

        </Grid>

        <!--  Game Status  -->
        <Border
          Margin="0,0,0,15"
          Padding="15"
          Background="#0f0f0f"
          BorderBrush="#2a2a2a"
          BorderThickness="1"
          CornerRadius="8">
          <StackPanel HorizontalAlignment="Center">
            <TextBlock
              HorizontalAlignment="Center"
              FontSize="16"
              FontWeight="Bold"
              Foreground="White"
              Text="{Binding GameStatus}" />
            <TextBlock
              HorizontalAlignment="Center"
              FontSize="12"
              Foreground="#8b8b8b"
              Text="{Binding GameStatusDescription}" />
          </StackPanel>
        </Border>

        <!--  Action Buttons  -->
        <Button
          Height="50"
          HorizontalAlignment="Stretch"
          hc:BorderElement.CornerRadius="8"
          Background="#dc3545"
          BorderThickness="0"
          Command="{Binding StartGameCommand}"
          Content="Start Game"
          FontSize="18"
          FontWeight="Bold"
          IsEnabled="{Binding CanStartGame}" />

        <Button
          Height="50"
          Margin="0,10,0,0"
          HorizontalAlignment="Stretch"
          hc:BorderElement.CornerRadius="8"
          Background="#22c55e"
          BorderThickness="0"
          Command="{Binding CollectWinningsCommand}"
          FontSize="18"
          FontWeight="Bold"
          IsEnabled="{Binding CanCollectWinnings}"
          Visibility="{Binding CanCollectWinnings, Converter={StaticResource Boolean2VisibilityConverter}}">
          <TextBlock Text="{Binding CollectButtonText}" />
        </Button>

      </StackPanel>

    </Grid>

  </Grid>
</UserControl>
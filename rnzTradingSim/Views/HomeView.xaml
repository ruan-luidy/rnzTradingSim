<UserControl
  x:Class="rnzTradingSim.Views.HomeView"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:hc="https://handyorg.github.io/handycontrol"
  xmlns:local="clr-namespace:rnzTradingSim.Views"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:vm="clr-namespace:rnzTradingSim.ViewModels"
  d:DataContext="{d:DesignInstance Type=vm:HomeViewModel}"
  d:DesignHeight="800"
  d:DesignWidth="1150"
  Background="{StaticResource DarkBackgroundBrush}"
  mc:Ignorable="d">

  <ScrollViewer HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto">
    <Grid Margin="24">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto" />
        <RowDefinition Height="Auto" />
        <RowDefinition Height="Auto" />
        <RowDefinition Height="*" />
      </Grid.RowDefinitions>

      <!--  Header - Welcome to Rugplay  -->
      <Border Grid.Row="0" Padding="0,0,0,32">
        <StackPanel>
          <TextBlock
            FontSize="30"
            FontWeight="Bold"
            Foreground="White"
            Text="{Binding GreetingText}" />
          <TextBlock
            Margin="0,8,0,0"
            FontSize="16"
            Foreground="{DynamicResource SecondaryTextBrush}"
            Text="{Binding SubtitleText}" />
        </StackPanel>
      </Border>

      <!--  Loading Indicator  -->
      <Grid 
        Grid.Row="1" 
        Visibility="{Binding IsLoading, Converter={StaticResource Boolean2VisibilityConverter}}"
        Margin="0,0,0,24">
        <hc:LoadingCircle
          HorizontalAlignment="Center"
          VerticalAlignment="Center"
          IsRunning="{Binding IsLoading}"
          Style="{StaticResource LoadingCircleLarge}" />
      </Grid>

      <!--  Top 6 Coins Grid  -->
      <Grid 
        Grid.Row="2" 
        Margin="0,0,0,48"
        Visibility="{Binding IsLoading, Converter={StaticResource Boolean2VisibilityReConverter}}">
        
        <ItemsControl ItemsSource="{Binding TopCoins}">
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <UniformGrid Columns="3" />
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>
          <ItemsControl.ItemTemplate>
            <DataTemplate>
              <!--  Coin Card  -->
              <Border
                Margin="8"
                Padding="24"
                Background="{DynamicResource CardBackgroundBrush}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="1"
                CornerRadius="8"
                Cursor="Hand"
                MouseLeftButtonUp="CoinCard_Click"
                Tag="{Binding}">
                <Border.Style>
                  <Style TargetType="Border">
                    <Style.Triggers>
                      <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="{DynamicResource SecondaryRegionBrush}" />
                        <Setter Property="Effect">
                          <Setter.Value>
                            <DropShadowEffect Color="#000000" BlurRadius="10" ShadowDepth="2" Opacity="0.3"/>
                          </Setter.Value>
                        </Setter>
                      </Trigger>
                    </Style.Triggers>
                  </Style>
                </Border.Style>

                <Grid>
                  <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                  </Grid.RowDefinitions>

                  <!--  Card Header  -->
                  <Grid Grid.Row="0" Margin="0,0,0,16">
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="*" />
                      <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!--  Coin Info  -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                      <!--  Coin Icon  -->
                      <Border
                        Width="24"
                        Height="24"
                        Margin="0,0,8,0"
                        Background="{StaticResource RugplayPrimaryBrush}"
                        CornerRadius="12">
                        <TextBlock
                          HorizontalAlignment="Center"
                          VerticalAlignment="Center"
                          FontSize="10"
                          FontWeight="Bold"
                          Foreground="White"
                          Text="{Binding Symbol}" />
                      </Border>
                      
                      <StackPanel>
                        <TextBlock
                          FontSize="16"
                          FontWeight="SemiBold"
                          Foreground="White"
                          Text="{Binding Name}" />
                        <TextBlock
                          FontSize="14"
                          Foreground="{DynamicResource SecondaryTextBrush}"
                          Text="{Binding Symbol, StringFormat=(*{0})}" />
                      </StackPanel>
                    </StackPanel>

                    <!--  24h Change Badge  -->
                    <Border
                      Grid.Column="1"
                      Padding="8,4"
                      VerticalAlignment="Top"
                      CornerRadius="4">
                      <Border.Style>
                        <Style TargetType="Border">
                          <Style.Triggers>
                            <DataTrigger Binding="{Binding IsPositiveChange}" Value="True">
                              <Setter Property="Background" Value="#16a34a" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding IsPositiveChange}" Value="False">
                              <Setter Property="Background" Value="#dc2626" />
                            </DataTrigger>
                          </Style.Triggers>
                        </Style>
                      </Border.Style>
                      <TextBlock
                        FontSize="12"
                        FontWeight="Medium"
                        Foreground="White"
                        Text="{Binding Change24h}" />
                    </Border>
                  </Grid>

                  <!--  Card Content  -->
                  <StackPanel Grid.Row="1">
                    <!--  Market Cap Description  -->
                    <TextBlock
                      Margin="0,0,0,8"
                      FontSize="14"
                      Foreground="{DynamicResource SecondaryTextBrush}"
                      Text="{Binding MarketCap, StringFormat=Market Cap: {0}}" />

                    <!--  Price and Volume  -->
                    <Grid>
                      <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                      </Grid.ColumnDefinitions>

                      <TextBlock
                        Grid.Column="0"
                        FontSize="30"
                        FontWeight="Bold"
                        Foreground="White"
                        Text="{Binding Price}" />

                      <StackPanel Grid.Column="1" VerticalAlignment="Bottom">
                        <TextBlock
                          HorizontalAlignment="Right"
                          FontSize="12"
                          Foreground="{DynamicResource SecondaryTextBrush}"
                          Text="{Binding Volume24hFormatted, StringFormat=24h Vol: {0}}" />
                      </StackPanel>
                    </Grid>
                  </StackPanel>
                </Grid>
              </Border>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </Grid>

      <!--  Market Overview Table  -->
      <Grid 
        Grid.Row="3"
        Visibility="{Binding IsLoading, Converter={StaticResource Boolean2VisibilityReConverter}}">
        
        <Border
          Background="{DynamicResource CardBackgroundBrush}"
          BorderBrush="{DynamicResource BorderBrush}"
          BorderThickness="1"
          CornerRadius="8">
          
          <Grid>
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto" />
              <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!--  Table Header  -->
            <Border Grid.Row="0" Padding="24,20">
              <TextBlock
                FontSize="24"
                FontWeight="Bold"
                Foreground="White"
                Text="Market Overview" />
            </Border>

            <!--  Data Table  -->
            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" MaxHeight="400">
              <DataGrid
                Padding="24,0,24,24"
                Background="Transparent"
                BorderBrush="Transparent"
                BorderThickness="0"
                CanUserAddRows="False"
                CanUserDeleteRows="False"
                CanUserReorderColumns="False"
                CanUserResizeColumns="False"
                CanUserResizeRows="False"
                CanUserSortColumns="True"
                GridLinesVisibility="None"
                HeadersVisibility="Column"
                IsReadOnly="True"
                ItemsSource="{Binding TopCoins}"
                RowBackground="Transparent"
                SelectionMode="Single"
                MouseDoubleClick="DataGrid_MouseDoubleClick">
                
                <DataGrid.RowStyle>
                  <Style TargetType="DataGridRow">
                    <Setter Property="Background" Value="Transparent" />
                    <Setter Property="Foreground" Value="White" />
                    <Setter Property="BorderThickness" Value="0,0,0,1" />
                    <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}" />
                    <Setter Property="Height" Value="60" />
                    <Style.Triggers>
                      <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="{DynamicResource SecondaryRegionBrush}" />
                        <Setter Property="Cursor" Value="Hand" />
                      </Trigger>
                    </Style.Triggers>
                  </Style>
                </DataGrid.RowStyle>

                <DataGrid.ColumnHeaderStyle>
                  <Style TargetType="DataGridColumnHeader">
                    <Setter Property="Background" Value="Transparent" />
                    <Setter Property="Foreground" Value="{DynamicResource SecondaryTextBrush}" />
                    <Setter Property="FontSize" Value="12" />
                    <Setter Property="FontWeight" Value="Medium" />
                    <Setter Property="Padding" Value="0,0,0,12" />
                    <Setter Property="BorderThickness" Value="0" />
                    <Setter Property="HorizontalContentAlignment" Value="Left" />
                  </Style>
                </DataGrid.ColumnHeaderStyle>

                <DataGrid.Columns>
                  <!--  Name Column  -->
                  <DataGridTemplateColumn Header="Name" Width="200">
                    <DataGridTemplateColumn.CellTemplate>
                      <DataTemplate>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                          <Border
                            Width="24"
                            Height="24"
                            Margin="0,0,8,0"
                            Background="{StaticResource RugplayPrimaryBrush}"
                            CornerRadius="12">
                            <TextBlock
                              HorizontalAlignment="Center"
                              VerticalAlignment="Center"
                              FontSize="10"
                              FontWeight="Bold"
                              Foreground="White"
                              Text="{Binding Symbol}" />
                          </Border>
                          <TextBlock
                            FontSize="14"
                            FontWeight="Medium"
                            Foreground="White"
                            Text="{Binding Name}" />
                        </StackPanel>
                      </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                  </DataGridTemplateColumn>

                  <!--  Price Column  -->
                  <DataGridTextColumn 
                    Header="Price" 
                    Binding="{Binding Price}"
                    Width="120">
                    <DataGridTextColumn.ElementStyle>
                      <Style TargetType="TextBlock">
                        <Setter Property="FontSize" Value="14" />
                        <Setter Property="Foreground" Value="White" />
                      </Style>
                    </DataGridTextColumn.ElementStyle>
                  </DataGridTextColumn>

                  <!--  24h Change Column  -->
                  <DataGridTemplateColumn Header="24h Change" Width="100">
                    <DataGridTemplateColumn.CellTemplate>
                      <DataTemplate>
                        <Border
                          Padding="8,4"
                          CornerRadius="4">
                          <Border.Style>
                            <Style TargetType="Border">
                              <Style.Triggers>
                                <DataTrigger Binding="{Binding IsPositiveChange}" Value="True">
                                  <Setter Property="Background" Value="#16a34a" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding IsPositiveChange}" Value="False">
                                  <Setter Property="Background" Value="#dc2626" />
                                </DataTrigger>
                              </Style.Triggers>
                            </Style>
                          </Border.Style>
                          <TextBlock
                            FontSize="12"
                            FontWeight="Medium"
                            Foreground="White"
                            Text="{Binding Change24h}" />
                        </Border>
                      </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                  </DataGridTemplateColumn>

                  <!--  Market Cap Column  -->
                  <DataGridTextColumn 
                    Header="Market Cap" 
                    Binding="{Binding MarketCap}"
                    Width="150">
                    <DataGridTextColumn.ElementStyle>
                      <Style TargetType="TextBlock">
                        <Setter Property="FontSize" Value="14" />
                        <Setter Property="Foreground" Value="White" />
                      </Style>
                    </DataGridTextColumn.ElementStyle>
                  </DataGridTextColumn>

                  <!--  Volume 24h Column  -->
                  <DataGridTextColumn 
                    Header="Volume (24h)" 
                    Binding="{Binding Volume24hFormatted}"
                    Width="*">
                    <DataGridTextColumn.ElementStyle>
                      <Style TargetType="TextBlock">
                        <Setter Property="FontSize" Value="14" />
                        <Setter Property="Foreground" Value="White" />
                      </Style>
                    </DataGridTextColumn.ElementStyle>
                  </DataGridTextColumn>
                </DataGrid.Columns>
              </DataGrid>
            </ScrollViewer>
          </Grid>
        </Border>
      </Grid>

    </Grid>
  </ScrollViewer>
</UserControl>

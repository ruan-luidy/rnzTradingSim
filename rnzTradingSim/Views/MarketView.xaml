<UserControl
  x:Class="rnzTradingSim.Views.MarketView"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:hc="https://handyorg.github.io/handycontrol"
  xmlns:local="clr-namespace:rnzTradingSim.Views"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:vm="clr-namespace:rnzTradingSim.ViewModels"
  d:DataContext="{d:DesignInstance Type=vm:MarketViewModel}"
  d:DesignHeight="800"
  d:DesignWidth="1150"
  Background="{DynamicResource DarkOpacityBrush}"
  mc:Ignorable="d">

  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
    </Grid.RowDefinitions>

    <!--  Header  -->
    <Border Grid.Row="0" Padding="40,30,40,20">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>

        <StackPanel Grid.Column="0">
          <TextBlock
            Foreground="White"
            Style="{StaticResource TextBlockLargeBold}"
            Text="Market" />
          <TextBlock
            Margin="0,5,0,0"
            Foreground="{DynamicResource SecondaryTextBrush}"
            Style="{StaticResource TextBlockDefault}"
            Text="Discover coins, track performance, and find your next investment" />
        </StackPanel>

        <StackPanel Grid.Column="1" Orientation="Horizontal">
          <Button
            Width="40"
            Height="40"
            Margin="0,0,10,0"
            hc:BorderElement.CornerRadius="8"
            Background="{DynamicResource RegionBrush}"
            BorderBrush="{DynamicResource BorderBrush}"
            Command="{Binding RefreshCommand}">
            <StackPanel Orientation="Horizontal">
              <Image
                Width="16"
                Height="16"
                VerticalAlignment="Center"
                Source="{StaticResource Refresh}" />
            </StackPanel>
          </Button>
        </StackPanel>
      </Grid>
    </Border>

    <!--  API Status  -->
    <Border Grid.Row="1" Padding="40,0,40,15">
      <Border
        Padding="12,8"
        HorizontalAlignment="Left"
        Background="#1a1a1a"
        BorderBrush="#333333"
        BorderThickness="1"
        CornerRadius="6">
        <StackPanel Orientation="Horizontal">
          <Border
            Width="8"
            Height="8"
            Margin="0,0,8,0"
            Background="#00ff88"
            CornerRadius="4" />
          <TextBlock
            FontSize="12"
            Foreground="#cccccc"
            Text="{Binding ApiStatusText}" />
        </StackPanel>
      </Border>
    </Border>

    <!--  Search and Filters  -->
    <Border Grid.Row="2" Padding="40,0,40,30">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>

        <!--  Search Box  -->
        <hc:SearchBar
          Grid.Column="0"
          Width="400"
          HorizontalAlignment="Left"
          hc:BorderElement.CornerRadius="8"
          hc:InfoElement.Placeholder="Search coins by name or symbol..."
          Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" />

        <!--  Filters Button  -->
        <Button
          Grid.Column="1"
          Height="32"
          Padding="15,0"
          hc:BorderElement.CornerRadius="8"
          Background="{DynamicResource RegionBrush}"
          BorderBrush="{DynamicResource BorderBrush}"
          BorderThickness="1"
          Command="{Binding ShowFiltersCommand}"
          Content="Filters" />
      </Grid>
    </Border>

    <!--  Loading Indicator  -->
    <Grid Grid.Row="3" Visibility="{Binding IsLoading, Converter={StaticResource Boolean2VisibilityConverter}}">
      <hc:LoadingCircle
        HorizontalAlignment="Center"
        VerticalAlignment="Center"
        IsRunning="{Binding IsLoading}"
        Style="{StaticResource LoadingCircleLarge}" />
    </Grid>

    <!--  Market Data  -->
    <Border
      Grid.Row="3"
      Margin="40,0,40,40"
      Padding="20"
      Background="{DynamicResource RegionBrush}"
      CornerRadius="12"
      Style="{StaticResource BorderRegion}"
      Visibility="{Binding IsLoading, Converter={StaticResource Boolean2VisibilityReConverter}}">
      <Grid>
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto" />
          <RowDefinition Height="*" />
          <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!--  Results Info  -->
        <TextBlock
          Grid.Row="0"
          Margin="0,0,0,20"
          FontSize="14"
          Foreground="{DynamicResource SecondaryTextBrush}"
          Text="{Binding ResultsText}" />

        <!--  Coins List  -->
        <ScrollViewer
          Grid.Row="1"
          HorizontalScrollBarVisibility="Disabled"
          VerticalScrollBarVisibility="Auto">
          <ItemsControl ItemsSource="{Binding FilteredCoins}">
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <Border
                  Margin="0,0,0,12"
                  Padding="20"
                  Background="{DynamicResource SecondaryRegionBrush}"
                  CornerRadius="8"
                  Style="{StaticResource BorderRegion}">
                  <Grid>
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="60" />
                      <ColumnDefinition Width="*" />
                      <ColumnDefinition Width="120" />
                      <ColumnDefinition Width="140" />
                      <ColumnDefinition Width="140" />
                      <ColumnDefinition Width="140" />
                      <ColumnDefinition Width="80" />
                    </Grid.ColumnDefinitions>

                    <!--  Rank  -->
                    <TextBlock
                      Grid.Column="0"
                      VerticalAlignment="Center"
                      FontSize="14"
                      FontWeight="Bold"
                      Foreground="{DynamicResource SecondaryTextBrush}"
                      Text="{Binding Rank}"
                      TextAlignment="Center" />

                    <!--  Coin Info  -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                      <Border
                        Width="32"
                        Height="32"
                        Margin="0,0,12,0"
                        Background="{Binding ImageColor}"
                        CornerRadius="16">
                        <Image
                          Width="24"
                          Height="24"
                          Source="{Binding Image}"
                          Stretch="UniformToFill" />
                      </Border>
                      <StackPanel VerticalAlignment="Center">
                        <TextBlock
                          FontSize="16"
                          FontWeight="Bold"
                          Foreground="White"
                          Text="{Binding Name}" />
                        <TextBlock
                          FontSize="12"
                          Foreground="{DynamicResource SecondaryTextBrush}"
                          Text="{Binding Symbol}" />
                      </StackPanel>
                    </StackPanel>

                    <!--  Price  -->
                    <TextBlock
                      Grid.Column="2"
                      VerticalAlignment="Center"
                      FontSize="16"
                      FontWeight="Bold"
                      Foreground="White"
                      Text="{Binding Price}" />

                    <!--  24h Change %  -->
                    <StackPanel Grid.Column="3" VerticalAlignment="Center">
                      <TextBlock
                        FontSize="14"
                        FontWeight="Bold"
                        Foreground="White"
                        Text="24h Change" />
                      <TextBlock
                        FontSize="12"
                        FontWeight="Bold"
                        Text="{Binding Change24h}">
                        <TextBlock.Style>
                          <Style BasedOn="{StaticResource TextBlockDefault}" TargetType="TextBlock">
                            <Style.Triggers>
                              <DataTrigger Binding="{Binding IsPositiveChange}" Value="True">
                                <Setter Property="Foreground" Value="{DynamicResource SuccessBrush}" />
                              </DataTrigger>
                              <DataTrigger Binding="{Binding IsPositiveChange}" Value="False">
                                <Setter Property="Foreground" Value="{DynamicResource DangerBrush}" />
                              </DataTrigger>
                            </Style.Triggers>
                          </Style>
                        </TextBlock.Style>
                      </TextBlock>
                    </StackPanel>

                    <!--  Market Cap  -->
                    <StackPanel Grid.Column="4" VerticalAlignment="Center">
                      <TextBlock
                        FontSize="14"
                        FontWeight="Bold"
                        Foreground="White"
                        Text="Market Cap" />
                      <TextBlock
                        FontSize="12"
                        Foreground="{DynamicResource SecondaryTextBrush}"
                        Text="{Binding MarketCap}" />
                    </StackPanel>

                    <!--  Volume  -->
                    <StackPanel Grid.Column="5" VerticalAlignment="Center">
                      <TextBlock
                        FontSize="14"
                        FontWeight="Bold"
                        Foreground="White"
                        Text="Volume (24h)" />
                      <TextBlock
                        FontSize="12"
                        Foreground="{DynamicResource SecondaryTextBrush}"
                        Text="{Binding Volume24hFormatted}" />
                    </StackPanel>

                    <!--  Hot/Wild Badge  -->
                    <StackPanel Grid.Column="6" VerticalAlignment="Center">
                      <Border
                        Padding="8,4"
                        Background="{Binding BadgeColor}"
                        CornerRadius="4"
                        Visibility="{Binding HasBadge, Converter={StaticResource Boolean2VisibilityConverter}}">
                        <TextBlock
                          FontSize="10"
                          FontWeight="Bold"
                          Foreground="White"
                          Text="{Binding BadgeText}" />
                      </Border>
                    </StackPanel>
                  </Grid>
                </Border>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
        </ScrollViewer>

        <!--  Pagination  -->
        <Grid Grid.Row="2" Margin="0,20,0,0">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
          </Grid.ColumnDefinitions>

          <Button
            Grid.Column="0"
            Width="80"
            Height="32"
            hc:BorderElement.CornerRadius="8"
            Command="{Binding PreviousPageCommand}"
            Content="Previous"
            IsEnabled="{Binding CanGoPreviousPage}" />

          <StackPanel
            Grid.Column="1"
            HorizontalAlignment="Center"
            Orientation="Horizontal">
            <Button
              Width="32"
              Height="32"
              Margin="2"
              hc:BorderElement.CornerRadius="8"
              Command="{Binding GoToPageCommand}"
              CommandParameter="1"
              Content="1">
              <Button.Style>
                <Style BasedOn="{StaticResource ButtonDefault}" TargetType="Button">
                  <Style.Triggers>
                    <DataTrigger Binding="{Binding CurrentPage}" Value="1">
                      <Setter Property="Background" Value="{DynamicResource PrimaryBrush}" />
                    </DataTrigger>
                  </Style.Triggers>
                </Style>
              </Button.Style>
            </Button>

            <Button
              Width="32"
              Height="32"
              Margin="2"
              hc:BorderElement.CornerRadius="8"
              Command="{Binding GoToPageCommand}"
              CommandParameter="2"
              Content="2">
              <Button.Style>
                <Style BasedOn="{StaticResource ButtonDefault}" TargetType="Button">
                  <Style.Triggers>
                    <DataTrigger Binding="{Binding CurrentPage}" Value="2">
                      <Setter Property="Background" Value="{DynamicResource PrimaryBrush}" />
                    </DataTrigger>
                  </Style.Triggers>
                </Style>
              </Button.Style>
            </Button>

            <Button
              Width="32"
              Height="32"
              Margin="2"
              hc:BorderElement.CornerRadius="8"
              Command="{Binding GoToPageCommand}"
              CommandParameter="3"
              Content="3">
              <Button.Style>
                <Style BasedOn="{StaticResource ButtonDefault}" TargetType="Button">
                  <Style.Triggers>
                    <DataTrigger Binding="{Binding CurrentPage}" Value="3">
                      <Setter Property="Background" Value="{DynamicResource PrimaryBrush}" />
                    </DataTrigger>
                  </Style.Triggers>
                </Style>
              </Button.Style>
            </Button>

            <Button
              Width="32"
              Height="32"
              Margin="2"
              hc:BorderElement.CornerRadius="8"
              Command="{Binding GoToPageCommand}"
              CommandParameter="4"
              Content="4">
              <Button.Style>
                <Style BasedOn="{StaticResource ButtonDefault}" TargetType="Button">
                  <Style.Triggers>
                    <DataTrigger Binding="{Binding CurrentPage}" Value="4">
                      <Setter Property="Background" Value="{DynamicResource PrimaryBrush}" />
                    </DataTrigger>
                  </Style.Triggers>
                </Style>
              </Button.Style>
            </Button>

            <TextBlock
              Margin="10,0"
              VerticalAlignment="Center"
              FontSize="14"
              Foreground="{DynamicResource SecondaryTextBrush}"
              Text="..." />

            <Button
              Width="32"
              Height="32"
              Margin="2"
              hc:BorderElement.CornerRadius="8"
              Command="{Binding GoToPageCommand}"
              CommandParameter="5"
              Content="5" />
          </StackPanel>

          <Button
            Grid.Column="2"
            Width="80"
            Height="32"
            hc:BorderElement.CornerRadius="8"
            Command="{Binding NextPageCommand}"
            Content="Next"
            IsEnabled="{Binding CanGoNextPage}" />
        </Grid>
      </Grid>
    </Border>
  </Grid>
</UserControl>